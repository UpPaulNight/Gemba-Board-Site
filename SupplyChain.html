<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Cache-Control" content="no-cache">
  <title>Supply Chain Procurement Board</title>
  <style>
    body {
      overflow: hidden;
      width: 100%;
      display: grid;
      place-items: center;
      /* margin: 0px; */
      background-color: white;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      height: 3852px;
    }
    .grid>canvas {
      border: 6px solid black;
      border-radius: 33px;
    }
    .splitFrame {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: auto;
      justify-content: space-between;
    }
    .splitFrame>.splitFrameCanvasContainer:last-child {
      margin-top: 6px;
    }
    .splitFrame>.splitFrameCanvasContainer:first-child {
      margin-bottom: 6px;
    }
    img {
      display: none;
    }
    #GembaName {
      font-size: 78pt;
      font-family: "PT Serif";
      width: 100%;
      text-align: center;
    }
    .splitFrame {
      border: none;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 13px;
    }
    .splitFrameCanvasContainer {
      border: 6px solid black;
      border-radius: 11px;
      width: 792.8px;
      display: flex;
      justify-content: center;
      flex: 1;
    }
    .splitFrameCanvasContainer>canvas {
      height: 505.75px;
    }
    .hidden {
      opacity: 0;
    }
    @media (max-height: 2160px) { /* Horizontal */
      .splitFrameCanvasContainer {
        height: 523.5px;
        width: 752px;
      }
      .grid {
        height: 2160px;
        row-gap: 9px;
        column-gap: 9px;
      }
      .splitFrame {
        width: 763.2px;
      }
      .splitFrameCanvasContainer>canvas {
        padding: 1px;
      }
    }
    @media (max-width: 2160px) { /* Vertical */
      .grid {
        grid-template-columns: repeat(2, 1fr);
        row-gap: 18px;
        column-gap: 18px;
      }
    }
  </style>
  <style>
    /* customizable snowflake styling */
    .snowflake {
      color: #fff;
      font-size: 1em;
      font-family: Arial, sans-serif;
      text-shadow: 0 0 5px #000;
    }
    
    .snowflake,.snowflake .inner{animation-iteration-count:infinite;animation-play-state:running}@keyframes snowflakes-fall{0%{transform:translateY(0)}100%{transform:translateY(110vh)}}@keyframes snowflakes-shake{0%,100%{transform:translateX(0)}50%{transform:translateX(80px)}}.snowflake{position:fixed;top:-10%;z-index:9999;-webkit-user-select:none;user-select:none;cursor:default;pointer-events:none;animation-name:snowflakes-shake;animation-duration:3s;animation-timing-function:ease-in-out}.snowflake .inner{animation-duration:10s;animation-name:snowflakes-fall;animation-timing-function:linear}.snowflake:nth-of-type(0){left:1%;animation-delay:0s}.snowflake:nth-of-type(0) .inner{animation-delay:0s}.snowflake:first-of-type{left:10%;animation-delay:1s}.snowflake:first-of-type .inner,.snowflake:nth-of-type(8) .inner{animation-delay:1s}.snowflake:nth-of-type(2){left:20%;animation-delay:.5s}.snowflake:nth-of-type(2) .inner,.snowflake:nth-of-type(6) .inner{animation-delay:6s}.snowflake:nth-of-type(3){left:30%;animation-delay:2s}.snowflake:nth-of-type(11) .inner,.snowflake:nth-of-type(3) .inner{animation-delay:4s}.snowflake:nth-of-type(4){left:40%;animation-delay:2s}.snowflake:nth-of-type(10) .inner,.snowflake:nth-of-type(4) .inner{animation-delay:2s}.snowflake:nth-of-type(5){left:50%;animation-delay:3s}.snowflake:nth-of-type(5) .inner{animation-delay:8s}.snowflake:nth-of-type(6){left:60%;animation-delay:2s}.snowflake:nth-of-type(7){left:70%;animation-delay:1s}.snowflake:nth-of-type(7) .inner{animation-delay:2.5s}.snowflake:nth-of-type(8){left:80%;animation-delay:0s}.snowflake:nth-of-type(9){left:90%;animation-delay:1.5s}.snowflake:nth-of-type(9) .inner{animation-delay:3s}.snowflake:nth-of-type(10){left:25%;animation-delay:0s}.snowflake:nth-of-type(11){left:65%;animation-delay:2.5s}
  </style>
  <style>
    @keyframes lights {
      0% {
        background-position: top; 
      } 
      100% {
        background-position: bottom;
      }
    }
    #lights {
      height:69px;
      background:url(https://i.imgur.com/BdGY6tH.png);
      animation: lights 1s infinite steps(2,jump-none);
      position: absolute;
      left: 0px;
      right: 0px;
      top: 0px;
    }
  </style>
  <script>
    let n = 15; // Minutes

    setTimeout(() => {
      window.location.href = window.location.pathname + "?t=" + new Date().getTime();
    }, n * 1000 * 60);
  </script>
</head>
<body>
    <!-- <div id="GembaName">SUPPLY CHAIN / PROCUREMENT GEMBA BOARD</div> -->
    <div class="grid">
      <canvas id="spot01"></canvas>
      <canvas id="spot02"></canvas>
      <div class="splitFrame">
        <div class="splitFrameCanvasContainer"><canvas id="spot03"></canvas></div>
        <div class="splitFrameCanvasContainer"><canvas id="spot04"></canvas></div>
      </div>
      <div class="splitFrame">
        <div class="splitFrameCanvasContainer"><canvas id="spot05"></canvas></div>
        <div class="splitFrameCanvasContainer"><canvas class="" id="spot06"></canvas></div>
      </div>
      <canvas class="hidden" id="spot07"></canvas>
      <canvas id="spot09"></canvas>
      <div class="hidden"><canvas id="spot10"></canvas></div>
      <canvas class="hidden" id="spot08"></canvas>
      <!-- <canvas id="spot09"></canvas> -->
      <!-- <canvas id="spot10"></canvas>
      <canvas id="spot11"></canvas> -->
    </div>
    <img id="img01" src="svg_files/safety_display_Supply Chain Procurement.svg">
    <img id="img02" src="svg_files/DeliveryOnTime.xlsm_DisplaySupplyChain.svg">
    <img id="img03" src="svg_files/DroppedHours_SupplyChain.xlsm_Display.svg">
    <img id="img04" src="svg_files/JobsComplNotClosed_SupplyChain.xlsm_Display.svg">
    <img id="img05" src="svg_files/ContinuousImprovement.xlsm_SupplyChain.svg">
    <img id="img06" src="svg_files/AP_Unreceived.xlsm_DisplaySupplyChain.svg">
    <img id="img07" src="">
    <img id="img08" src="">
    <img id="img09" src="svg_files/JobsNotWIPCleared.xlsx_WIPSupplyText.svg">
    <img id="img10" src="">
    <img id="img11" src="">
    <img id="img12" src="">
    <div id="lights"></div>
    <div class="snowflakes" aria-hidden="true">
      <div class="snowflake">
        <div class="inner">❅</div>
      </div>
      <div class="snowflake">
        <div class="inner">❅</div>
      </div>
      <div class="snowflake">
        <div class="inner">❅</div>
      </div>
      <div class="snowflake">
        <div class="inner">❅</div>
      </div>
      <div class="snowflake">
        <div class="inner">❅</div>
      </div>
      <div class="snowflake">
        <div class="inner">❅</div>
      </div>
      <div class="snowflake">
        <div class="inner">❅</div>
      </div>
      <div class="snowflake">
        <div class="inner">❅</div>
      </div>
      <div class="snowflake">
        <div class="inner">❅</div>
      </div>
      <div class="snowflake">
        <div class="inner">❅</div>
      </div>
      <div class="snowflake">
        <div class="inner">❅</div>
      </div>
      <div class="snowflake">
        <div class="inner">❅</div>
      </div>
    </div>
    <script>
      const images = document.querySelectorAll('img')
      const canvases = document.querySelectorAll('canvas')

      function setWidth(canvas, parentClassContains) {
        if (parentClassContains == 'grid') {
          switch (window.screen.availWidth) {
            case 2160:
              canvas.width = 1040;
              break;
            case 3840:
              canvas.width = 752;
              break;
            case 4096:
              canvas.width = 781;
              break;
            default:
              console.log('Unknown resolution');
          }

        } else if (parentClassContains == 'splitFrame') {
          switch (window.screen.availWidth) {
            case 3840:
            case 4096:
              canvas.width = 699;
              break;
            case 2160:
              canvas.width= 877;
              break;
            default:
              console.log('Unknown resolution');
          }
        }
      }

      function setHeight(canvas, parentClassContains) {

        if (parentClassContains == 'grid') {
          switch (window.screen.height) {
            case 2160:
              canvas.height = 1063.5;
              break;
            case 3840:
            case 4096:
              canvas.height = 1260;
              break;
            default:
              console.log('Unknown resolution');
          }

        } else if (parentClassContains == 'splitFrame') {
          switch (window.screen.height) {
            case 2160:
              canvas.height = 521.25
              // canvas.height = 508;
              break;
            case 4096:
            case 3840:
              canvas.height = 618;
              break;
            default:
              console.log('Unknown resolution');
          }
        }
      }
      
      function setCanvasDimensions() {

        console.log('Resizing canvases...');
        console.log('Screen Width: ' + window.screen.availWidth);
        console.log('Screen Height: ' + window.screen.availHeight);
        
        canvases.forEach(canvas => {
          const parent = canvas.parentElement;
          const parentClassContains = parent.classList.contains('grid') ? 'grid' : parent.classList.contains('splitFrameCanvasContainer') ? 'splitFrame' : '';
          setWidth(canvas, parentClassContains);
          setHeight(canvas, parentClassContains);
        });
      }

      function drawImageToCanvas(image, canvas) {
        const ctx = canvas.getContext("2d");
        const scale = Math.min(canvas.width / image.width, canvas.height / image.height);
        const w = image.width * scale;
        const h = image.height * scale;
        const x = (canvas.width - w) / 2; // center horizontally
        const y = (canvas.height - h) / 2; // center vertically
        ctx.fillStyle = "white";
        ctx.rect(0, 0, canvas.width, canvas.height);
        ctx.fill();
        ctx.drawImage(image, x, y, w, h);
      }

      function drawAllImagesToCanvases() {
        for (let i = 1; i <= 12; i++) {
          const img = document.getElementById(`img${String(i).padStart(2, '0')}`);
          const canvas = document.getElementById(`spot${String(i).padStart(2, '0')}`);
          if (img && canvas) {
            drawImageToCanvas(img, canvas);
          }
        }
      }

      
      function draw_images() {
        setCanvasDimensions();
        
        let loadedCount = 0;
        const imagesList = Array.from({length: 12}, (_, i) => document.getElementById(`img${String(i+1).padStart(2, '0')}`));
  
        imagesList.forEach(img => {
          if (img.complete) {
            loadedCount++;
            if (loadedCount === imagesList.length) drawAllImagesToCanvases();
          } else {
            img.addEventListener('load', () => {
              loadedCount++;
              if (loadedCount === imagesList.length) drawAllImagesToCanvases();
            });
          }
        });
      }

      window.addEventListener("load", draw_images);
      
      let resizeTimer;
      window.addEventListener("resize", () => {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(draw_images, 1000);
      });
    </script>
</body>
</html>
